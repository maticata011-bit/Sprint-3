{
  "name": "HU-006 - Consolidación de Solicitudes",
  "nodes": [
    {
      "id": "webhookEntrada",
      "name": "Webhook - Fin Proceso",
      "type": "n8n-nodes-base.webhook",
      "position": [200, 300],
      "parameters": {
        "httpMethod": "POST",
        "path": "hu006-fin-proceso",
        "responseMode": "onReceived"
      }
    },
    {
      "id": "setDatos",
      "name": "Extraer Datos",
      "type": "n8n-nodes-base.set",
      "position": [450, 300],
      "parameters": {
        "keepOnlySet": false,
        "values": {
          "string": [
            {
              "name": "solicitudId",
              "value": "={{ $json.solicitudId }}"
            },
            {
              "name": "estadoFinal",
              "value": "={{ $json.estadoFinal }}"
            },
            {
              "name": "fechaResolucion",
              "value": "={{ $json.fechaResolucion }}"
            }
          ]
        }
      }
    },
    {
      "id": "buscarFila",
      "name": "Buscar fila por ID",
      "type": "n8n-nodes-base.googleSheets",
      "position": [700, 300],
      "parameters": {
        "operation": "lookup",
        "sheetId": "TU_SHEET_ID",
        "range": "Historial!A:D",
        "lookupColumn": "SolicitudID",
        "lookupValue": "={{ $json.solicitudId }}",
        "returnAllMatches": false
      }
    },
    {
      "id": "actualizarFila",
      "name": "Actualizar Registro",
      "type": "n8n-nodes-base.googleSheets",
      "position": [950, 300],
      "parameters": {
        "operation": "update",
        "sheetId": "TU_SHEET_ID",
        "range": "Historial!A:D",
        "keyName": "SolicitudID",
        "keyValue": "={{ $json.solicitudId }}",
        "dataMode": "manual",
        "fields": {
          "values": {
            "Estado Final": "={{ $json.estadoFinal }}",
            "Fecha de Resolución": "={{ $json.fechaResolucion }}",
            "Convalidada": "={{ $json.estadoFinal === 'Convalidada' ? 'Sí' : 'No' }}"
          }
        }
      }
    },
    {
      "id": "respuestaOK",
      "name": "Responder",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [1200, 300],
      "parameters": {
        "responseBody": "Solicitud actualizada correctamente"
      }
    }
  ],
  "connections": {
    "webhookEntrada": {
      "main": [
        [
          {
            "node": "Extraer Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extraer Datos": {
      "main": [
        [
          {
            "node": "Buscar fila por ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar fila por ID": {
      "main": [
        [
          {
            "node": "Actualizar Registro",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Actualizar Registro": {
      "main": [
        [
          {
            "node": "Responder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}
